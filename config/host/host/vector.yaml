docker:
  images:
    remote:
      vector:
        repo: timberio/vector
        tag: "0.52.0-debian"
  volumes:
    local:
      vector-config:
        backup: false
      vector-data: {}
services:
  vector:
    depends-on:
      - host: sun
        service: openobserve
    config: {}
    files:
      config:
        path:
          extract:
            volume: vector-config
          transform:
            path: config.toml
        content:
          format: toml
          data:
            acknowledgements:
              enabled: true
            data_dir:
              volume: vector-data
    container:
      image: vector
      command:
        - "--config-dir"
        - volume: vector-config
      hostname:
        hinfo: name
      volumes:
        vector-config:
          path: /etc/vector
          read-only: true
          bind-file: false
        vector-data: /var/lib/vector
    containers:
      reload:
        depends-on: [null]
        oneshot: true
        image: docker-cli
        docker-socket:
          write: false
        # TODO: use `docker kill` after https://github.com/moby/moby/issues/41302
        command:
          - "exec"
          - container:
            extract:
              cinfo: id
          - "/bin/sh"
          - "-c"
          - "kill -s HUP 1"
        volumes:
          vector-config:
            path: /etc/vector
            read-only: true
