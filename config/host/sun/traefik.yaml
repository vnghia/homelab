services:
  traefik:
    config:
      entrypoint:
        config:
          private-http:
            port:
              service: tailscale
              extract:
                svariable: HTTP_EXTERNAL_PORT
            to:
              service: tailscale
              extract:
                svariable: HTTPS_EXTERNAL_PORT
          public-http:
            port:
              service: tailscale
              extract:
                svariable: HTTP_INTERNAL_PORT
            to:
              service: tailscale
              extract:
                svariable: HTTPS_EXTERNAL_PORT
          private-https:
            port:
              service: tailscale
              extract:
                svariable: HTTPS_EXTERNAL_PORT
            http3: {}
            timeout: &timeout
              read: 12h
              write: 12h
              idle: 12h
          public-https:
            port:
              service: tailscale
              extract:
                svariable: HTTPS_INTERNAL_PORT
            http3:
              port:
                service: tailscale
                extract:
                  svariable: HTTPS_EXTERNAL_PORT
            timeout: *timeout
        mapping:
          public: ["public-https"]
          private: ["private-https"]
