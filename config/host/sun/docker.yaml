docker:
  volumes:
    local:
      docker-proxy-mtls:
        active: false
      docker-earth-mtls:
        backup: false
services:
  traefik:
    container:
      volumes:
        docker-proxy-mtls:
          active: false
  docker:
    variables:
      EARTH_CA_PATH:
        extract:
          svolume: docker-earth-mtls
        transform:
          path: ca.crt
      EARTH_CERT_PATH:
        extract:
          svolume: docker-earth-mtls
        transform:
          path: client.crt
      EARTH_KEY_PATH:
        extract:
          svolume: docker-earth-mtls
        transform:
          path: client.pem
    config:
      depends-on:
        - host: earth
          service: docker
      traefik:
        proxy:
          active: false
          record: sun
    files:
      file:
        ca:
          active: false
        cert:
          active: false
        key:
          active: false
        earth-ca:
          bind: false
          path:
            svariable: EARTH_CA_PATH
          content:
            host: earth
            extract:
              service: docker
              extract:
                mtls: proxy-mtls
                info: ca_cert
        earth-cert:
          bind: false
          path:
            svariable: EARTH_CERT_PATH
          content:
            host: earth
            extract:
              service: docker
              extract:
                mtls: proxy-mtls
                info: client_cert
        earth-key:
          bind: false
          path:
            svariable: EARTH_KEY_PATH
          content:
            host: earth
            extract:
              service: docker
              extract:
                mtls: proxy-mtls
                info: client_key
    secrets: null
