apiVersion: dashboard.grafana.app/v2beta1
kind: Dashboard
metadata:
  name: docker
spec:
  annotations:
    - kind: AnnotationQuery
      spec:
        builtIn: true
        enable: true
        hide: true
        iconColor: rgba(0, 211, 255, 1)
        name: Annotations & Alerts
        query:
          datasource:
            name: "-- Grafana --"
          group: grafana
          kind: DataQuery
          spec: {}
          version: v0
  cursorSync: "Off"
  editable: false
  elements:
    container-count:
      kind: Panel
      spec:
        id: 0
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    datasource: &datasource
                      name:
                        secret: openobserve-prometheus-datasource-uid
                    group: prometheus
                    kind: DataQuery
                    spec:
                      expr: count(container_last_seen{namespace="$namespace", name!=""})
                      format: time_series
                      instant: false
                      legendFormat: "{{namespace}}: Containers"
                    version: v0
                  refId: Containers
            queryOptions: {}
            transformations: []
        description: Total number of running containers last seen by the exporter.
        links: []
        title: Containers
        vizConfig:
          group: stat
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  fixedColor: text
                  mode: fixed
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                    - color: red
                      value: 80
            options:
              colorMode: value
              graphMode: area
              justifyMode: auto
              orientation: auto
              percentChangeColorMode: standard
              reduceOptions:
                calcs:
                  - lastNotNull
                fields: ""
                values: false
              showPercentChange: false
              textMode: auto
              wideLayout: true
    image-count:
      kind: Panel
      spec:
        id: 1
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    datasource: *datasource
                    group: prometheus
                    kind: DataQuery
                    spec:
                      expr: count (sum by (image) (container_last_seen{namespace="$namespace", name!=""}))
                      format: time_series
                      instant: false
                      legendFormat: "{{namespace}}: Images"
                    version: v0
                  refId: Images
            queryOptions: {}
            transformations: []
        description: Total number of distinct images found across running containers.
        links: []
        title: Images
        vizConfig:
          group: stat
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  fixedColor: text
                  mode: fixed
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                    - color: red
                      value: 80
            options:
              colorMode: value
              graphMode: area
              justifyMode: auto
              orientation: auto
              percentChangeColorMode: standard
              reduceOptions:
                calcs:
                  - lastNotNull
                fields: ""
                values: false
              showPercentChange: false
              textMode: auto
              wideLayout: true
    total-cpu-usage:
      kind: Panel
      spec:
        id: 2
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    datasource: *datasource
                    group: prometheus
                    kind: DataQuery
                    spec:
                      expr: avg by (name) (rate(container_cpu_usage_seconds_total{namespace="$namespace", name!=""}[$__rate_interval])) * 100
                      format: time_series
                      instant: false
                      legendFormat: "{{namespace}}"
                    version: v0
                  refId: CPU usage
            queryOptions: {}
            transformations:
              - kind: calculateField
                spec:
                  id: calculateField
                  options:
                    mode: reduceRow
                    reduce:
                      reducer: sum
                    replaceFields: true
        description: >
          Total CPU utilization percent is a metric that indicates the overall
          level of central processing unit (CPU) usage in a computer system.

          It represents the combined load placed on all CPU cores or processors.


          For instance, if the total CPU utilization percent is 50%, it means
          that,

          on average, half of the CPU's processing capacity is being used to
          execute tasks. A higher percentage indicates that the CPU is working
          more intensively, potentially leading to system slowdowns if it
          remains consistently high.
        links: []
        title: CPU usage
        vizConfig:
          group: stat
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  fixedColor: text
                  mode: continuous-BlYlRd
                decimals: 1
                max: 100
                min: 0
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                    - color: red
                      value: 80
                unit: percent
            options:
              colorMode: value
              graphMode: area
              justifyMode: auto
              orientation: auto
              percentChangeColorMode: standard
              reduceOptions:
                calcs:
                  - lastNotNull
                fields: ""
                values: false
              showPercentChange: false
              textMode: auto
              wideLayout: true
    total-memory-reserved:
      kind: Panel
      spec:
        id: 3
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    datasource: *datasource
                    group: prometheus
                    kind: DataQuery
                    spec:
                      expr: sum(container_spec_memory_reservation_limit_bytes{namespace="$namespace", name!=""})
                      format: time_series
                      instant: false
                      legendFormat: "{{namespace}}: Memory reserved"
                    version: v0
                  refId: Memory reserved
            queryOptions: {}
            transformations: []
        description: Memory reserved by the containers on the machine.
        links: []
        title: Memory reserved
        vizConfig:
          group: stat
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  fixedColor: text
                  mode: continuous-BlYlRd
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                unit: bytes
            options:
              colorMode: value
              graphMode: area
              justifyMode: auto
              orientation: auto
              percentChangeColorMode: standard
              reduceOptions:
                calcs:
                  - lastNotNull
                fields: ""
                values: false
              showPercentChange: false
              textMode: auto
              wideLayout: true
    total-memory-usage:
      kind: Panel
      spec:
        id: 4
        data:
          kind: QueryGroup
          spec:
            queries:
              - kind: PanelQuery
                spec:
                  hidden: false
                  query:
                    datasource: *datasource
                    group: prometheus
                    kind: DataQuery
                    spec:
                      expr: sum(container_memory_usage_bytes{namespace="$namespace", name!=""})
                      format: time_series
                      instant: false
                      legendFormat: "{{namespace}}: Memory used"
                    version: v0
                  refId: Memory used
            queryOptions: {}
            transformations: []
        description: Memory used by all containers.
        links: []
        title: Memory used
        vizConfig:
          group: stat
          kind: VizConfig
          spec:
            fieldConfig:
              defaults:
                color:
                  fixedColor: text
                  mode: continuous-BlYlRd
                thresholds:
                  mode: absolute
                  steps:
                    - color: green
                      value: 0
                unit: bytes
            options:
              colorMode: value
              graphMode: area
              justifyMode: auto
              orientation: auto
              percentChangeColorMode: standard
              reduceOptions:
                calcs:
                  - lastNotNull
                fields: ""
                values: false
              showPercentChange: false
              textMode: auto
              wideLayout: true
  layout:
    kind: RowsLayout
    spec:
      rows:
        - kind: RowsLayoutRow
          spec:
            collapse: false
            layout:
              kind: GridLayout
              spec:
                items:
                  - kind: GridLayoutItem
                    spec:
                      element:
                        kind: ElementReference
                        name: container-count
                      height: 4
                      width: 4
                      x: 0
                      y: 0
                  - kind: GridLayoutItem
                    spec:
                      element:
                        kind: ElementReference
                        name: image-count
                      height: 4
                      width: 4
                      x: 4
                      y: 0
                  - kind: GridLayoutItem
                    spec:
                      element:
                        kind: ElementReference
                        name: total-cpu-usage
                      height: 4
                      width: 4
                      x: 8
                      y: 0
                  - kind: GridLayoutItem
                    spec:
                      element:
                        kind: ElementReference
                        name: total-memory-reserved
                      height: 4
                      width: 4
                      x: 12
                      y: 0
                  - kind: GridLayoutItem
                    spec:
                      element:
                        kind: ElementReference
                        name: total-memory-usage
                      height: 4
                      width: 4
                      x: 16
                      y: 0
            title: Overview
        - kind: RowsLayoutRow
          spec:
            collapse: false
            layout:
              kind: GridLayout
              spec:
                items: []
            title: Compute
  links: []
  liveNow: false
  preload: false
  timeSettings:
    autoRefresh: ""
    autoRefreshIntervals:
      - 15s
      - 30s
      - 1m
      - 5m
      - 15m
      - 30m
      - 1h
      - 2h
      - 1d
    fiscalYearStartMonth: 0
    from: now-6h
    hideTimepicker: false
    timezone: browser
    to: now
  title: Docker
  variables:
    - kind: QueryVariable
      spec:
        name: namespace
        current:
          text: sun
          value: sun
        label: Namespace
        hide: dontHide
        refresh: onDashboardLoad
        options: []
        query:
          datasource: *datasource
          group: prometheus
          kind: DataQuery
          spec:
            __legacyStringValue: label_values(container_last_seen, namespace)
          version: v0
        regex: ""
        regexApplyTo: value
        sort: alphabeticalAsc
        multi: false
        includeAll: false
        allowCustomValue: false
    - kind: QueryVariable
      spec:
        name: service
        includeAll: true
        allValue: .+
        current:
          text: All
          value: $__all
        label: Service
        hide: dontHide
        refresh: onTimeChanged
        options: []
        query:
          datasource: *datasource
          group: prometheus
          kind: DataQuery
          spec:
            __legacyStringValue: label_values(container_last_seen{namespace="$namespace"}, service)
          version: v0
        regex: ""
        regexApplyTo: value
        sort: alphabeticalAsc
        multi: true
        allowCustomValue: false
    - kind: QueryVariable
      spec:
        name: alias
        includeAll: true
        allValue: .+
        current:
          text: All
          value: $__all
        label: Alias
        hide: dontHide
        refresh: onTimeChanged
        options: []
        query:
          datasource: *datasource
          group: prometheus
          kind: DataQuery
          spec:
            __legacyStringValue: label_values(container_last_seen{namespace="$namespace", service=~"$service"}, alias)
          version: v0
        regex: ""
        regexApplyTo: value
        sort: alphabeticalAsc
        multi: true
        allowCustomValue: false
    - kind: QueryVariable
      spec:
        name: name
        includeAll: true
        allValue: .+
        current:
          text: Name
          value: $__all
        label: Name
        hide: dontHide
        refresh: onTimeChanged
        options: []
        query:
          datasource: *datasource
          group: prometheus
          kind: DataQuery
          spec:
            __legacyStringValue: label_values(container_last_seen{namespace="$namespace", service=~"$service", alias=~"$alias"}, name)
          version: v0
        regex: ""
        regexApplyTo: value
        sort: alphabeticalAsc
        multi: true
        allowCustomValue: false
status: {}
