name: homelab
description: My homelab IaC configuration
runtime:
  name: python
  options:
    virtualenv: .venv
    typechecker: mypy
config:
  pulumi:tags:
    value:
      pulumi:template: python
  docker:
    value:
      platform: amd64
      networks:
        bridge:
          default-bridge: {}
      images:
        tailscale:
          repo: tailscale/tailscale
          tag: "v1.78.3"
      volumes:
        local:
          tailscale-data: {}
      services:
        tailscale:
          containers:
            tailscale:
              image: tailscale
              capabilities:
                - NET_ADMIN
              healthcheck:
                tests:
                  - "CMD"
                  - "wget"
                  - "--spider"
                  - "-q"
                  - "http://127.0.0.1:8080/healthz"
                interval: 1s
                timeout: 5s
              sysctls:
                "net.ipv6.conf.all.disable_ipv6": "0"
                "net.ipv6.conf.all.forwarding": "1"
                "net.ipv6.conf.all.proxy_ndp": "1"
              tmpfs:
                - "/tmp"
                - "/run"
              networks:
                default-bridge: {}
              volumes:
                tailscale-data: /var/lib/tailscale
              envs:
                TS_STATE_DIR:
                  volume: tailscale-data
                TS_USERSPACE: "false"
                TS_AUTH_ONCE: "true"
                TS_HEALTHCHECK_ADDR_PORT: "127.0.0.1:8080"
