name: homelab
description: My homelab IaC configuration
runtime:
  name: python
  options:
    virtualenv: .venv
    typechecker: mypy
config:
  pulumi:tags:
    value:
      pulumi:template: python
  docker:
    value:
      platform: amd64
      networks:
        bridge:
          default-bridge: {}
      images:
        tailscale:
          repo: tailscale/tailscale
          tag: "v1.78.3"
      volumes:
        local:
          tailscale-data: {}
      services:
        tailscale:
          container:
            image: tailscale
            capabilities:
              - NET_ADMIN
            healthcheck:
              tests:
                - "CMD"
                - "wget"
                - "--spider"
                - "-q"
                - "http://localhost:9002/healthz"
              interval: 1s
              timeout: 5s
            ports:
              httpv4:
                internal: 81
                external: 80
                ip: "0.0.0.0"
              httpv6:
                internal: 81
                external: 80
                ip: "::"
              httpsv4:
                internal: 444
                external: 443
                ip: "0.0.0.0"
              httpsv6:
                internal: 444
                external: 443
                ip: "::"
            tmpfs:
              - "/tmp"
              - "/run"
            networks:
              default-bridge: {}
            volumes:
              tailscale-data: /var/lib/tailscale
            envs:
              TS_STATE_DIR:
                volume: tailscale-data
              TS_USERSPACE: "false"
              TS_AUTH_ONCE: "true"
              TS_ENABLE_HEALTH_CHECK: "true"
